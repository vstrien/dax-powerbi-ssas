# Automatic date tables, quick measures, and date tables in DAX

## Automatic date tables

When you load new data into Power BI, Power BI can create "hidden date tables" for you for each date column that is not used in a relationship. The goal is to always have the ability to apply *time intelligence* functions such as `PARALLELPERIOD` and `SAMEPERIODLASTYEAR1`. Power BI also provides a hierarchy under each date field.

You can enable or disable this setting for the current file under **File**, **Options and settings**, **Options**. Then select **Current File** -> **Data Load** -> **Auto date/time**

![Options](img/options-settings.png)
![Auto date/time](img/automatic-date-time.png)

While it is ideal to have these tables available for quick analysis, they have some limitations.

* The data models can become quite large, even for small datasets. This can be a problem when you want to share a quick analysis via email with a colleague. I shared a blog post about this some time ago: [Here is why the size of small Power BI models is tens of MBs](https://www.bitrainer.nl/2020/03/06/size-of-small-power-bi-models-is-tens-of-mbs/)
* It does not allow you to combine multiple date fields in a single analysis. [Alberto Ferrari has written an article about it "DAX 101: Automatic Time Intelligence in Power BI"](https://www.sqlbi.com/articles/automatic-time-intelligence-in-power-bi/).

## Quick Measures

Many **quick measures** offer convenient functions for performing date/time analysis. However, they can only be used on automatically generated *date tables* or date tables that have been designated as such within the DAX data model.

1. Try creating a new **quick measure** for "Year-to-Date / Total from Year Start". Use the following values:
   * Base value: `Count of Delivery Rows`
   * Date: `'Delivery Date'[Date]`

You will now receive a message that only date fields generated by Power BI or primary date columns are supported. You can resolve this by designating the tables as date tables. Follow these steps:

2. Select the **Date** table
3. The **Table Tools** tab will now appear on the ribbon.
4. Select **Mark as Date Table**
5. In the dialog box that appears, select the `[Date]` column as the date column
6. Repeat these steps for the other date tables in your model (`Delivery Date` and `Invoice Date`)

7. Now create the **quick measure** as you tried to do in step 2. Make sure it ends up in the `Sale` table.
   * Verify its functionality with a line chart that plots the new measure against `'Delivery Date'[Date]`

![Outcome of YTD delivery rows](img/ytd-delivery-rows-outcome.png)

> DAX requires a date table for many time intelligence functions. A date table is a table with a column of type *Date*, containing exactly one row per day from the earliest to the latest date in that table. By providing this assurance, various "clever tricks" such as parallel periods and year-to-date (quarter-to-date, month-to-date) calculations can be easily implemented.
>
> The date tables generated by Power BI are always marked as *date tables*.

## Custom date tables

When retrieving data from a Data Warehouse, you usually have extensive date dimensions at your disposal. All sorts of date fields relevant to your organization are already included. Some examples include:

* 4-week period systems
* ISO week numbering
* Fiscal years different from calendar years
* etc.

However, it is also common to need a date table "just for now" during an ad-hoc analysis in Power BI. If you want to create a custom date table, you can easily do so using functions such as:

* `CALENDAR( <start date> , <end date> )`
* `CALENDARAUTO()`

In particular, `CALENDARAUTO` is very useful: it scans your entire data model for dates and creates a date table based on the first and last dates in your model. It rounds to whole years: the start date is always January 1st and the end date is always December 31st.

8. Create a new date table using `CALENDARAUTO`. Name the table `Dates`
9. Add the following columns to this table:
   * Month Number
   * Short Month (use the definition `FORMAT([Date], "mmm")`)
10. Create a visualization where you plot `'Dates'[Short Month]` against `[Count of Invoice Rows]`
   * Make the necessary adjustments in the data model to ensure that the counts are accurate
   * Make the necessary adjustments in the `'Dates'` table to ensure that the `[Short Month]` column is correctly sorted. [If you're having trouble, here is a tip on how to solve it](https://radacad.com/sort-by-column-in-power-bi)
11. Expand the date table with a few additional calculated columns. Refer to the documentation at [https://docs.microsoft.com/en-us/dax/format-function-dax](https://docs.microsoft.com/en-us/dax/format-function-dax). Under the "See Also" heading, you will find more pages with information on the so-called "format strings" (such as the `mmm` that produced the abbreviated month). You can consider:
   * Year + Short Month ("2018 Jan")
   * Full Month Name ("January")
   * A written-out date ("Wednesday 12 March 2008" or "Wednesday, March 12, 2008"). Note: you don't need to use codes like "yyyy" and "mmm" here!
   * Year-month-day notation ("2018-02-01")
12. Create a visualization where you plot `'Dates'[Year + Short Month]` against the YTD function you created earlier with a *quick measure* (in a Dutch-language Power BI, this is called `[Year-to-Date of Count of Delivery Rows]`). 
   * Ensure that the "2018 Jan" notation is sorted correctly. 
   * If you don't have a good column to use for sorting, add a column to get the sorting right.
13. *This is a bonus task*. Create a column with a year-month combination ("201812"). The column should be numeric. Do not use the `FORMAT` function. Also, do not use any other columns besides the `[Date]` column.

## Bonus: Generating custom tables with DAX

We just generated a table using `CALENDARAUTO` and then manually added several columns to it. However, you can also create and extend a table in a single DAX statement using the `ADDCOLUMNS` function.

14. *This is a bonus task*. Create a new *calculated table* named `Dates-AddColumns`. It should contain the first three columns of the `Dates` table using a single `ADDCOLUMNS` function. You are not allowed to reference the `Dates` table :-).
   * Look up the documentation of `ADDCOLUMNS` on [dax.guide](https://dax.guide)
   * The first argument (the `<table>`) is `CALENDARAUTO()`
   * Try to figure out the other arguments on your own.